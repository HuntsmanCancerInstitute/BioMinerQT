
<form name="queryForm" class="form-horizontal">
<fieldset>

	<!--                 -->
    <!--  Toolbar        -->
 	<!--                 -->
   	<div class="row" style="padding-top:12px" >
  	       <h3 class="pull-left h3-toolbar"">
   	       		<span class="glyphicon glyphicon-zoom-in"></span> Query
		   </h3>
	</div>
	

	 			
	<!--                 -->
    <!--  Main panel     -->
 	<!--                 -->
	<div class="row">
	
	
     	<!--                         -->
        <!--  Query (sidebar) Panel  -->
     	<!--                         -->
     	<div class="col-sm-12 col-md-12 col-lg-4">  
 

     	
            <div class="panel panel-default">
				<div class="panel-heading">
				    Compose Query
				     			
					<button type="button" class="btn btn-sm btn-default pull-right" style="margin-top: -6px;margin-left: 10px" ng-click="clearQuery()" ng-hide="queryStarted">
	  					<span class="glyphicon glyphicon-refresh"></span> Clear
		   			</button>
		   			<button type="button" class="btn btn-sm btn-danger pull-right" style="margin-top: -6px;margin-left: 10px" ng-click="abortQuery()" ng-show="queryStarted">
		   				<span class="glyphicon glyphicon-stop"></span> Stop Query
		   			</button>
					<button type="button" class="btn btn-sm btn-warning pull-right" style="margin-top: -6px"  ng-click="runQuery(queryForm.$invalid)" ng-hide="queryStarted">
	  					<span class="glyphicon glyphicon-play"></span> Run Query
		   			</button>
				</div>
	  	   
				
           	 	<div class="panel-body">
            	 	
           	 		<span class="section-header" style="padding-top: 0px">What would you like to find?</span>
           	 			
           	 		<!-- What type of result do you want back? -->
           	 		<div class="form-group" style="padding-top: 0px">
					  <div class="col-md-12"> 
					    <label ng-repeat="(key,name) in mapResultType" class="radio-inline" for="radio-rt-{{ key }}">
					      <input name="resultType"
					      		 id="radio-rt-{{ key }}"
					      		 required
					      	     ng-model="$parent.codeResultType" 
					      	     ng-value="key" 
					      	     ng-change="pickResultType()"
					      	     type="radio">{{ name }}
					    </label> 
					  </div>
					  <div class="col-md-12" ng-show="queryForm.resultType.$error.required && showValidation">
					  	<span class="label label-danger" >Required</span>
					  </div>
					  
					</div>

  
           	 		<span class="section-header" >What Genome?</span>
					<div class="form-group" >
		  				<div class="col-md-12">
		    				<select name="gbSelect"
		    				        ng-model="idOrganismBuild" 
		    				        required
		    				        ng-options="gb.idOrganismBuild as gb.name group by gb.organism.common for gb in organismBuildList" 
		    				        class="form-control">
		    				        <option value="">Select Organism Build</option>
		    				</select>
		  				</div>
		  				<div class="col-md-12" ng-show="queryForm.gbSelect.$error.required && showValidation">
		  					<span class="label label-danger" >Required</span>
		  				</div>
					</div>
					
  
           	 		<span class="section-header" >What Datasets?</span>
           	 		
           	 		<!-- What data sets? -->
					<div class="form-group">
					  <div class="col-md-9">
					    <label ng-repeat="analysisType in analysisTypeCheckedList"  
					           class="radio-inline" 
					           ng-class="analysisType.class"
					           for="radio-at-{{ analysisType.idAnalysisType }}">
					      <input name="analysisRadio" 
					             ng-required="true" 
					             ng-disabled="!analysisType.show || !analysisType.possible || searchExisting"
					             id="radio-at-{{ analysisType.idAnalysisType }}" 
					             type="radio"
					             ng-model="$parent.selectedAnalysisType"
					             ng-value="analysisType">
					     {{ analysisType.type }}
					    </label>    
					  </div>
					  <div class="col-md-3">
					        <label for="searchResults">Search Results</label>
					  		<input name="searchResults" type="checkbox" ng-model="searchExisting" ng-disabled="!hasResults"/>
					  </div>
					  
					  <div class="col-md-12" ng-show="queryForm.analysisRadio.$error.required && showValidation">
					  	<span class="label label-danger" >Required</span>
					  </div>
					</div>
					
					
					<!--  Lab -->
					<div class="form-group" >
						<label class="col-md-3 control-label" for=""labEntry">Labs</label> 
						<select width="70" data-placeholder="Choose labs..." multiple class="form-control chosen-select" ng-model="selectedLabs" chosen ng-options="lab as (lab.first + ' ' + lab.last + ' lab' ) for lab in labList track by lab.idLab" ng-disabled="searchExisting" ></select> 
					</div>
					
					<!--  Analysis Project -->
					<div class="form-group">
						<label class="col-md-3 control-label" for=""labEntry">Analysis Projects</label> 
					    <select width="70" data-placeholder="Choose analysis projects..." multiple class=" form-control chosen-select" ng-model="selectedProjects" chosen="projectList" ng-options="project as project.name for project in projectList track by project.idProject" ng-disabled="searchExisting"  ></select>
					</div>
					
					<!--  Analysis  -->
					<div class="form-group">
						<label class="col-md-3 control-label" for=""labEntry">Individual Analysis</label> 
					    <select width="70" data-placeholder="Choose individual analysis..." multiple class="form-control chosen-select" ng-model="selectedAnalyses" chosen="analysisList" ng-options="a as a.name for a in analysisList track by a.idAnalysis" ng-disabled="searchExisting"  ></select>
					</div>
					
					<!--  Sample Source  -->
					<div class="form-group">
						<label class="col-md-3 control-label" for=""labEntry">Sample Source</label>  
					    <select width="70" data-placeholder="Choose sample source..." multiple class="form-control chosen-select" ng-model="selectedSampleSources" chosen  ng-options="sampleSource as sampleSource.source for sampleSource in sampleSourceList track by sampleSource.idSampleSource" ng-disabled="searchExisting"  ></select>
					</div>
			
          	 		<!-- Interest or Don't Intersect -->
           	 		<span class="section-header" >That</span>
          	 		
          	 		<div class="form-group">
					  <div class="col-md-12"> 
					  <div class="btn-group">
   					     	<label class="btn btn-toggle" ng-model="isReverse" btn-radio="false" >Intersect</label>
        					<label class="btn btn-toggle" ng-model="isReverse" btn-radio="true">Don't Intersect</label>
    					</div>
    					<span class="btn btn-primary pull-right fileinput-button col-md-4" ng-show="intersectionTarget == 'REGION'">
					        <i class="glyphicon glyphicon-upload"></i>
					        <span>Import Regions</span>
					        <input type="file" ng-file-select="loadRegions($files)">            
					    </span>
					    <span class="btn btn-primary pull-right fileinput-button col-md-4" ng-show="intersectionTarget == 'GENE'">
					        <i class="glyphicon glyphicon-upload"></i>
					        <span>Import Genes</span>
					        <input type="file" ng-file-select="loadGenes($files)">            
					    </span>
					  </div>
					</div>
				
          	 		<!-- Regions-->
					<div class="form-group" ng-show="codeResultType!='GENE' && codeResultType == 'REGION'">
					    <div class="col-md-2" style="padding-right: 0px;">
					      <div class="radio" required>
						   		<label for="radio-region">
							    	<input name="radios-region-gene" id="radio-region" ng-model="intersectionTarget" value="REGION" type="radio"> Regions
						   		</label>
						  </div>
					    </div>
					    <div class="col-md-10" ng-show="intersectionTarget == 'REGION'" style="padding-left: 1px; padding-right: 0px;">
						    <div class="col-md-7"  >
					    		<textarea name="regionField" ng-model="regions" class="form-control" placeholder="chr1:4500-8900" ng-required="intersectionTarget=='REGION'"/>
					    		<span class="label label-danger" ng-show="queryForm.regionField.$error.required && showValidation">Required when 'region' intersections are specified</span>
					    	</div>
					    	<div class="col-md-5">
						    	&nbsp;&nbsp;Padding +/- bp
						    	<input type="text" ng-model="regionMargins" style="display: inline;" class="form-control" placeholder="1000"/> 
					    	</div>
					    </div>
					</div>
							 
          	 		<!-- Genes-->
					<div class="form-group" ng-show="codeResultType=='GENE' || codeResultType=='REGION'">
						<div class="col-md-2" style="padding-right: 0px;" >
					      <div class="radio">
						   		<label for="radio-gene">
							    	<input name="radios-region-gene" id="radio-gene"  ng-model="intersectionTarget" value="GENE" type="radio"> Genes
						   		</label>
						  </div>
						</div>
					 	<div class="col-md-10" ng-show="intersectionTarget == 'GENE'" style="padding-left: 1px; padding-right: 0px;">
 							<div class="col-md-7">
 								<angucomplete-alt id="test" minlength="2" placeholder="Search for gene.." pause="400" selected-object="searchGenes" local-data="hugoList" title-field="geneName" search-fields="geneName" input-class="form-control" match-class="highlight" clear-selected="true"/>
 							</div>
					    	<br>
					    	<div class="col-md-7">
					    		<textarea name="geneField" ng-model="genes" class="form-control" placeholder="ACTB, GAPDH, ..." ng-required="intersectionTarget=='GENE'"/>
					    		<span class="label label-danger" ng-show="queryForm.geneField.$error.required && showValidation">Required when 'gene' intersections are specified</span>
					    	</div>
					    	<div class="col-md-5">
						    	&nbsp;&nbsp;Padding +/- bp
						    	<input type="text" ng-model="geneMargins" style="display: inline;"class="form-control" placeholder="1000"/>
					    	</div>
					    	
					    	 
				    	</div>
					</div>
					
					<!-- Everything -->
					<div class="form-group" ng-show="codeResultType=='GENE' || codeResultType=='REGION'">
						<div class="col-md-3" style="padding-right: 0px;">
					      <div class="radio">
						   		<label for="radio-everything">
							    	<input name="radios-region-everything" id="radio-everything" ng-model="intersectionTarget" value="EVERYTHING" type="radio"> Anything
						   		</label>
						  </div>
					    </div>
					</div>
					
					<!--  Thresholds -->
           	 		<span class="section-header" ng-show="isThresholdBasedQuery">That Exceed these Thresholds</span>
           	 		 
           	 		 <!-- FDR-->
					<div class="form-group" ng-show="isThresholdBasedQuery">
					  <label class="col-md-2 control-label" >FDR</label>  
				  	  <div class="col-md-5 btn-group ">
				  	  		<label class="btn btn-toggle" ng-model="codeThresholdFDRComparison" btn-radio="'GT'" >&gt;</label>
				  	  		<label class="btn btn-toggle" ng-model="codeThresholdFDRComparison" btn-radio="'LT'" >&lt;</label>
  					     	
   					  </div>
					  <input id="textinput" class="col-md-3 form-control" style="display: inline; max-width: 120px" ng-model="thresholdFDR" name="textinput" placeholder=".05"  type="number" step="0.1">
					</div>        
					
           	 		
           	 		 <!-- Log2 Ratio-->
					<div class="form-group" ng-show="isThresholdBasedQuery">
					    <label class="col-md-2 control-label">Log2Ratio</label>  
					  	<div class="col-md-5 btn-group">
   					     	<label class="btn btn-toggle" ng-model="codeThresholdLog2RatioComparison" btn-radio="'GTABS'" >&gt; abs</label>
   					     	<label class="btn btn-toggle" ng-model="codeThresholdLog2RatioComparison" btn-radio="'GT'"     >&gt;</label>
        					<label class="btn btn-toggle" ng-model="codeThresholdLog2RatioComparison" btn-radio="'LT'"     >&lt;</label>
    					</div>
					    
						<input id="textinput" class="col-md-3 form-control"   style="display: inline; max-width: 120px" ng-model="thresholdLog2Ratio" name="textinput" placeholder="1.0"  type="number" step="0.1">
					</div>        

					
					
					<!--  Variant Criteria -->
           	 		<span class="section-header" ng-hide="isThresholdBasedQuery"  >That Meet Variant Criteria</span>

					<!-- Variant qual filter -->
					<div class="form-group" ng-hide="isThresholdBasedQuery">
					  <label class="col-md-3 control-label" for="variant-filter-radios">Qual</label>
					  <div class="col-md-6">
					  	<div class="btn-group">
   					     	<label class="btn btn-toggle" ng-model="codeThresholdVariantQualComparison" btn-radio="'>'" >&gt;</label>
        					<label class="btn btn-toggle" ng-model="codeThresholdVariantQualComparison" btn-radio="'<'" >&lt;</label>
    					</div>
						<input id="textinput" class="form-control col-md-3" ng-model="thresholdVariantQual" name="textinput" placeholder="20" type="text">
					  </div>
					</div>

					
					<!-- Variant pass/nopass filter -->
					<div class="form-group" ng-hide="isThresholdBasedQuery">
					  <label class="col-md-3 control-label" for="variant-filter-radios">Filter</label>
					  <div class="col-md-6"> 
					    <label class="radio-inline" for="variant-filter-radios-0">
					      <input name="variant-filter-radios" id="variant-filter-radios-0" ng-model="codeVariantFilterPass" value="PASS" checked="checked" type="radio">
					      PASS
					    </label> 
					    <label class="radio-inline" for="variant-filter-radios-1">
					      <input name="variant-filter-radios" id="variant-filter-radios-1" ng-model="codeVariantFilterPass"  value="NOPASS" type="radio">
					      Not PASS
					    </label>
					  </div>
					</div>
					
					<!-- Variant type -->
					<div class="form-group" ng-hide="isThresholdBasedQuery">
					  <label class="col-md-3 control-label" for="variant-type-radios">Type</label>
					  <div class="col-md-6"> 
					    <label class="radio-inline" for="variant-type-radios-0">
					      <input name="variant-type-radios" id="variant-type-radios-0" ng-model="codeVariantFilterType" value="SNV" checked="checked" type="radio">
					      SNV
					    </label> 
					    <label class="radio-inline" for="variant-type-radios-1">
					      <input name="variant-type-radios" id="variant-type-radios-1"  ng-model="codeVariantFilterType" value="INDEL" type="radio">
					      INDEL
					    </label>
					  </div>
					</div>
					
        	 		<!-- Variant Genotype-->
					<div class="form-group" ng-hide="isThresholdBasedQuery">
					 	<label class="col-md-3 control-label" for="genotypes">Genotype</label>
					    <div class="col-md-9">
						    <select name="genotypes" data-placeholder="Choose genotypes..."   multiple class="col-md-12 chosen-select" ng-model="selectedGenotypes" chosen ng-options="genotype.name for genotype in genotypeList"  ></select>
					    </div>
					</div>

					
					<div class="btn-toolbar" role="toolbar" >
			   			<button type="button" class="btn btn-sm btn-default pull-right" style="margin-top: -6px;margin-left: 10px" ng-click="clearQuery()" ng-hide="queryStarted">
	  						<span class="glyphicon glyphicon-refresh"></span> Clear
		   				</button>
			   			<button type="button" class="btn btn-sm btn-danger pull-right" style="margin-top: -6px;margin-left: 10px" ng-click="abortQuery()" ng-show="queryStarted">
			   					<span class="glyphicon glyphicon-stop"></span> Stop Query
			   			</button>
						<button type="button" class="btn btn-sm btn-warning pull-right" style="margin-top: -6px"  ng-click="runQuery(queryForm.$invalid)" ng-hide="queryStarted">
		  						<span class="glyphicon glyphicon-play"></span> Run Query
			   			</button>
					</div>	
					
          	 		
 				</div> <!-- end of panel body -->
			</div> <!--  end of panel -->
     	</div> <!--  end of sidebar  -->
     	
     	
     	<!--                 -->
        <!--  Results Panel  -->
     	<!--                 -->
		<div class="col-sm-12 col-md-12 col-lg-8" >
			
			<div class=" panel panel-default">
			
				<div class="panel-heading" >
				  Results  
				  <span class="label label-success" ng-show="totalResults>0">{{totalResults}}</span>
			   	  <button type="button" class="btn btn-sm btn-info pull-right" ng-show="hasResults" ng-click="loadIgvSession()" ng-disabled="totalDatatracks == 0" style="margin-top: -6px; margin-left: 10px"><span class="glyphicon glyphicon-eye-open"></span> Display in IGV</button>
			   	  <a class="btn btn-sm btn-info pull-right" ng-show="hasResults" style="margin-top: -6px; margin-left: 10px" target="_self" ng-href="query/downloadAnalysis?codeResultType={{returnedResultType}}"><span class="glyphicon glyphicon-download"></span> Download</a>
			   	  <button type="button" class="btn btn-sm btn-danger pull-right" ng-show="warnings != ''" ng-click="displayWarnings()" style="margin-top: -6px; margin-left: 10px"><span class="glyphicon glyphicon-exclamation-sign"></span> Query</button>
			   	  <button type="button" class="btn btn-sm btn-danger pull-right" ng-show="igvWarnings != ''" ng-click="displayWarnings('igv')" style="margin-top: -6px; margin-left: 10px"><span class="glyphicon glyphicon-exclamation-sign"></span> IGV</button>
			   	  <button type="button" class="btn btn-sm btn-primary pull-right" style="margin-top: -6px;margin-left: 10px" ng-click="loadExistingData()" ng-hide="loggedUser == null || hasResults">	
				   	<span class="glyphicon glyphicon-cloud"></span> Load Last
				  </button> 	 
				</div>
				
				<div class="panel-body">
				
				<!-- The query summary -->
				<div class="row" style="margin-top: 0px; margin-bottom: 10px;">
					<div class="col-md-12">
			   	       	<span class="well-querysum" ng-repeat="row in querySummary">{{ row }}</span> 
					</div>
				</div>	

			    <table class="table table-striped table-hover col-md-12"  ng-show="hasResults">
<!-- 			    	<colgroup> -->
<!-- 			    	    <col width="0%" /> -->
<!-- 				        <col width="0%" /> -->
<!-- 				        <col width="20%" /> -->
<!-- 				        <col width="25%" /> -->
<!-- 				        <col width="0%" /> -->
<!-- 				        <col width="25%" /> -->
<!-- 				        <col width="25%" /> -->
<!-- 				        <col width="0%" /> -->
<!-- 				        <col width="0%" /> -->
<!-- 				        <col width="0%" /> -->
<!-- 				    </colgroup> -->
			        <thead>
			            <tr>
			                <th><input type="checkbox" ng-model="selectAll"></th>
			                <th>Index</th>
							<th>Project</th>
							<th>Analysis</th>
							<th>Type</th>
							<th>Search</th>
							<th ng-show="selectedAnalysisType.type == 'RNASeq'"><button type="button" class="btn btn-xs btn-primary" ng-click="copyGenes()"><span class="glyphicon glyphicon-share"></span></button>Gene</th>
							<th>Conditions</th>
							<th>
								<button type="button" class="btn btn-xs btn-primary" ng-click="copyCoordinates()"><span class="glyphicon glyphicon-share"></span></button>
								<span >Coordinates</span>
								<button type="button" class="btn btn-xs btn-primary" ng-click="sortType='Coordinate';changeTablePosition()"><span class="glyphicon glyphicon-sort"></span></button>
							</th>
							<th>
								<span>FDR</span>
								<button type="button" class="btn btn-xs btn-primary" ng-click="sortType='FDR';changeTablePosition()"><span class="glyphicon glyphicon-sort"></span></button>
							</th>
							<th>
								<span >Log2Ratio</span>
								<button type="button" class="btn btn-xs btn-primary" ng-click="sortType='Log2Ratio';changeTablePosition()"><span class="glyphicon glyphicon-sort"></span></button>
							</th>
			            </tr>
			        </thead>
			        <tbody>
			            <tr ng-repeat="row in queryResults">
			            	<td><input type="checkbox" ng-model="row.selected"/></td>
			            	<td class="nowrap">{{row.index}}</td>
			                <td class="nowrap-ellipsis" ><span tooltip="{{row.projectName}}">{{row.projectName}}</td>
			                <td class="nowrap-ellipsis"><span tooltip="{{row.analysisName}}">{{row.analysisName}}</span></td>
			                <td class="nowrap">{{row.analysisType}}</td>
			                <td class="nowrap">{{row.search}}</span></td>
			                <td class="nowrap" ng-show="selectedAnalysisType.type == 'RNASeq'">{{row.mappedName}}</td>
			                <td class="nowrap-ellipsis"><span tooltip="{{row.sampleConditions}}">{{row.sampleConditions}}</td>
			                <td class="nowrap" ng-hide="igvLoaded">{{row.coordinates}}</td>
			                <td class="nowrap" ng-show="igvLoaded"><a ng-click="loadLocus(row)">{{row.coordinates}}</a></td>
			                <td class="nowrap">{{row.fdr}}</td>
			                <td class="nowrap">{{row.log2Ratio}}</td>
			            </tr>
			
			        </tbody>
			
			    </table>

				<div class="row show-grid" ng-show="totalResults > 0">
		    			<button type="button" ng-disabled="queryCurrentPage == 0" ng-click="queryCurrentPage=queryCurrentPage-1;changeTablePosition()" class="btn btn-mini col-lg-1"><span class="glyphicon glyphicon-chevron-left"></span> </button>
		    			<div class="center col-lg-10">
		    			    <div class="row">
			    			    <select ng-model="resultsPerPage" class="center" ng-change="changeTablePosition()">
			    			    	<option value=10>Show 10</option>
			 		     	    	<option value=25>Show 25</option>
			 		     	    	<option value=50>Show 50</option>
			 		     	    	<option value=75>Show 75</option>
			 		     	    	<option value=100>Show 100</option>
		 		     	    	</select>
		    			    </div>
		    			    <div class="row">
		    			    	<small class="center">Page {{queryCurrentPage+1}} of {{resultPages}} </small>
		    			    </div>
		    			</div>
		    			
			    		<button type="button" ng-disabled="queryCurrentPage >= resultPages" ng-click="queryCurrentPage=queryCurrentPage+1;changeTablePosition()" class="btn btn-mini col-lg-1">
			    			<span class="glyphicon glyphicon-chevron-right"></span>
			    		</button>
	     	   	</div>
				
			</div>
		
		</div> 
		
	</div>  <!-- end of row (main panel) -->

</fieldset>
</form>


